version: '3.7'

volumes:

  ethvm-kafka-processing:
    external: false

  parity:
    external: false

services:

  # ///////////////////////////////////////////////////////
  # Ethereum Client
  # ///////////////////////////////////////////////////////

  parity:
    volumes:
      - parity:/home/parity/.local/share/io.parity.ethereum/

  # ///////////////////////////////////////////////////////
  # Front Services
  # ///////////////////////////////////////////////////////

  api:
    environment:
      INSTA_MINING: 'true'
      DISABLE_EXPRESS_RATE_LIMIT: 'true'

  # ///////////////////////////////////////////////////////
  # Processing
  # ///////////////////////////////////////////////////////

  ethvm-kafka-processing:
    build:
      context: ./apps/processing
      dockerfile: ./kafka-streams/Dockerfile
    restart: unless-stopped
    depends_on:
      - kafka-1
      - zookeeper
      - kafka-schema-registry
    networks:
      - net
    volumes:
      - ethvm-kafka-processing:/var/lib/kafka-streams
    environment:
      KAFKA_BOOTSTRAP_SERVERS: kafka-1:9091
      KAFKA_SCHEMA_REGISTRY_URL: http://kafka-schema-registry:8081
      WEB3_WS_URL: ws://parity:8546
      KAFKA_STREAMS_STATE_DIR: /var/lib/kafka-streams
      ETH_NET_CONFIG: 'dev'
